load("@bazel_skylib//rules:native_binary.bzl", "native_test")
load("@rules_cc//cc:defs.bzl", "cc_library", "cc_test")
load("@rules_ecsact//ecsact:defs.bzl", "ecsact_binary", "ecsact_build_recipe")

cc_library(
    name = "local_dep",
    srcs = ["local_dep.cc"],
    hdrs = ["local_dep.hh"],
)

ecsact_build_recipe(
    name = "ecsact_build_test_recipe",
    tags = ["manual"],
    srcs = [
        "ecsact_build_test.cc",
        "local_dep.cc",
        "local_dep.hh",
    ],
    codegen_plugins = {
        "//:test_codegen_plugin": "src",
    },
    exports = [
        "ecsact_execute_systems",
        "ecsact_create_registry",
    ],
    imports = [
        "ecsact_system_execution_context_get",
        "ecsact_system_execution_context_action",
    ],
)

ecsact_binary(
    name = "test",
    tags = ["manual"],
    srcs = [
        "test.ecsact",
    ],
    recipes = [
        ":ecsact_build_test_recipe",
    ],
)
